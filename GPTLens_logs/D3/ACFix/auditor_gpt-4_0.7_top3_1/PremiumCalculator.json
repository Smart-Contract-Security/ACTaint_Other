[
    {
        "function_name": "calculatePremium",
        "code": "function calculatePremium( uint256 _protectionDurationInSeconds, uint256 _protectionAmount, uint256 _protectionBuyerApy, uint256 _leverageRatio, uint256 _totalCapital, ProtectionPoolParams calldata _poolParameters ) external view virtual override returns (uint256 _premiumAmount, bool _isMinPremium) { console.log( \"Calculating premium... protection duration in seconds: %s, protection amount: %s, leverage ratio: %s\", _protectionDurationInSeconds, _protectionAmount, _leverageRatio ); int256 _carapacePremiumRate; uint256 _durationInYears = _calculateDurationInYears( _protectionDurationInSeconds ); if ( RiskFactorCalculator.canCalculateRiskFactor( _totalCapital, _leverageRatio, _poolParameters.leverageRatioFloor, _poolParameters.leverageRatioCeiling, _poolParameters.minRequiredCapital ) ) { int256 _riskFactor = RiskFactorCalculator.calculateRiskFactor( _leverageRatio, _poolParameters.leverageRatioFloor, _poolParameters.leverageRatioCeiling, _poolParameters.leverageRatioBuffer, _poolParameters.curvature ); _carapacePremiumRate = _calculateCarapacePremiumRate( _durationInYears, _riskFactor ); console.logInt(_carapacePremiumRate); } else { _isMinPremium = true; } int256 _minCarapaceRiskPremiumPercent = int256( _poolParameters.minCarapaceRiskPremiumPercent ); int256 _carapacePremiumRateToUse = _carapacePremiumRate > _minCarapaceRiskPremiumPercent ? _carapacePremiumRate : _minCarapaceRiskPremiumPercent; console.logInt(_carapacePremiumRateToUse); uint256 _underlyingPremiumRate = _calculateUnderlyingPremiumRate( _durationInYears, _protectionBuyerApy, _poolParameters.underlyingRiskPremiumPercent ); console.log(\"Underlying premium rate: %s\", _underlyingPremiumRate); assert(_carapacePremiumRateToUse > 0); uint256 _premiumRate = uint256(_carapacePremiumRateToUse) + _underlyingPremiumRate; console.log(\"Premium rate: %s\", _premiumRate); _premiumAmount = (_protectionAmount * _premiumRate) / Constants.SCALE_18_DECIMALS; }",
        "vulnerability": "Integer underflow",
        "reason": "If the _carapacePremiumRate turns out to be negative or zero, the assert statement that checks if _carapacePremiumRateToUse > 0 will fail, causing a revert. However, this check does not prevent underflow when calculating _carapacePremiumRate which is derived from mathematical operations involving exponentiation and could potentially result in negative values if not properly managed.",
        "file_name": "PremiumCalculator.sol"
    },
    {
        "function_name": "_calculateCarapacePremiumRate",
        "code": "function _calculateCarapacePremiumRate( uint256 _durationInYears, int256 _riskFactor ) internal pure returns (int256) { int256 _power = (-1 * int256(_durationInYears) * _riskFactor) / Constants.SCALE_18_DECIMALS_INT; return Constants.SCALE_18_DECIMALS_INT - (_power.exp()); }",
        "vulnerability": "Floating point arithmetic",
        "reason": "The use of floating point arithmetic in the calculation of _power and the subsequent exponentiation can lead to precision issues, potentially causing the returned premium rate to be incorrect. Solidity is not well-suited for handling floating point numbers, and this might lead to unexpected results in the premium calculation.",
        "file_name": "PremiumCalculator.sol"
    },
    {
        "function_name": "_calculateDurationInYears",
        "code": "function _calculateDurationInYears(uint256 _protectionDurationInSeconds) internal pure returns (uint256) { return (_protectionDurationInSeconds * 100 * Constants.SCALE_18_DECIMALS) / (uint256(Constants.SECONDS_IN_DAY) * 36524); }",
        "vulnerability": "Arithmetic overflow",
        "reason": "This function multiplies _protectionDurationInSeconds with 100 and Constants.SCALE_18_DECIMALS before dividing by the product of Constants.SECONDS_IN_DAY and 36524. If large values are passed as _protectionDurationInSeconds, this can lead to arithmetic overflow during multiplication, resulting in incorrect computations of duration.",
        "file_name": "PremiumCalculator.sol"
    }
]